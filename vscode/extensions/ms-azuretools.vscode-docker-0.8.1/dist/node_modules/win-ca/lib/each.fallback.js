// Generated by CoffeeScript 1.12.7

/*
Enumerate system root CAs
 */
var bufferFrom, der2, each, exe, path, spawn, split;

path = require('path');

spawn = require('child_process');

split = require('split');

der2 = require('./der2');

bufferFrom = Buffer.from || function(data, encoding) {
  return new Buffer(data, encoding);
};

module.exports = each = function(format, cb) {
  var child;
  cb || (cb = format);
  child = spawn.spawnSync(exe());
  split(function(blob) {
    if (!blob) {
      return;
    }
    return cb(der2(format, bufferFrom(blob, 'hex')));
  }).end(child.stdout);
};


/*
Asynchronous enumeration

Callback:
  cb(error):      error
  cb(null, crt):  certificate
  cb():           done
 */

each.async = function(format, cb) {
  cb || (cb = format);
  return spawn.spawn(exe()).stdout.pipe(split(function(blob) {
    if (!blob) {
      return;
    }
    return cb(null, der2(format, bufferFrom(blob, 'hex')));
  })).on('end', function() {
    cb(null);
  });
};

exe = function() {
  return path.join(__dirname, 'roots');
};
