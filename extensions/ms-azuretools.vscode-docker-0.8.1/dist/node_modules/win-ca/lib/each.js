// Generated by CoffeeScript 1.12.7

/*
Enumerate system root CAs
 */
var crypt, der2, each;

crypt = require("./binding");

der2 = require('./der2');

module.exports = each = function(format, cb) {
  var blob, store;
  cb || (cb = format);
  store = crypt();
  try {
    while (blob = store.next()) {
      cb(der2(format, blob));
    }
  } finally {
    store.done();
  }
};


/*
Asynchronous enumeration

Callback:
  cb(error):      error
  cb(null, crt):  certificate
  cb():           done
 */

each.async = function(format, cb) {
  return setImmediate(function() {
    var step, store;
    cb || (cb = format);
    store = crypt();
    return (step = function() {
      return setImmediate(function() {
        var blob, error;
        try {
          if (blob = store.next()) {
            cb(null, der2(format, blob));
            step();
          } else {
            store.done();
            cb();
          }
        } catch (error1) {
          error = error1;
          store.done();
          cb(error);
        }
      });
    })();
  });
};
