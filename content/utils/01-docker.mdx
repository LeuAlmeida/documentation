---
title: "Docker"
metaTitle: "Docker"
metaDescription: "Conceitos e usos de Docker"
---

## Manual de Uso

### O que é um container?

"Um container é um padrão de unidade de software que empacota código e todas as dependências de uma aplicação, fazendo com que a mesma seja executada rapidamente de forma confiável de um ambiente computacional para outro." - _Fonte: docker.com_

#### Como funciona?
* Criação de ambientes isolados *(container)*;
* Containers expõe portas para comunicação;

#### Principais conceitos
* Imagem (serviço disponível, exemplo: SQL, Postgres, REdis)
* Container (instância de uma imagem)
* Docker Registry (Docker Hub)
* Dockerfile:
  * Receita de uma imagem

## Comandos
Para listar todos os containers que estão rodando
```bash
$ docker ps
```

Para listar todos os containers (incluindo os que não estão rodando)
```bash
$ docker ps -a
```

Para parar um container usa-se `$ docker stop NOME_DO_CONTAINER`, exemplo:
```bash
$ docker stop database
```

Para iniciar um container parado, usa-se:
```bash
$ docker start NOME_DO_CONTAINER
```

Para rodar um container
```bash
$ docker run --name nginx -d -p 8080:80 nginx

# A flag -p serve para redirecionar a porta localhost para a porta do container
# A flag -d significa detached, para que o container não fique preso ao terminal
# A flag --name serve para nomear o container
```
## Acessando e alterando arquivos de um container

```bash
$ docker exec -it nginx bash

# A flag -it representa a interação com o container
# O comando "exec" representa a execução do comando para com o próprio container
# O comando "bash" aponta que deverá rodar o bash dentro dele
```

## Bind mounts

O bind mount serve para montar um container com arquivos pré definidos, por exemplo:
Ao carregar um container Nginx, o exemplo abaixo montará o arquivo index.html (localhost:8080) com um arquivo index.html pré setado localmente:

```bash
$ docker run -d --name nginx -p 8080:80 -v ~/Desktop/PESSOAL/Cursos/fullcycle/docker/bind-mounts/:/usr/share/nginx/html nginx
```
De forma segura (sem criar a pasta localmente):

```bash
$ docker run -d --name nginx -p 8080:80 --mount type=bind,source="$(pwd)",target=/usr/share/nginx/html nginx
```

## Trabalhando com volumes

Para criar um volume:
```bash
$ docker volume create meuvolume
```

Para listar os volumes:
```bash
$ docker volume ls
```

Para inspecionar um volume:
```bash
$ docker volume inspect meuvolume
```

Para criar um container apontando para um volume em específico:
```bash
$ docker run --name nginx -d --mount type=volume,source=meuvolume,target=/app nginx

# ou

$ docker run --name nginx -d -v meuvolume:/app nginx
```
* Caso seja criado um  segundo container usando o mesmo volume, ele compartilhará as informações pré existentes

Para limpar os volumes

```bash
$ docker volume prune
```

## Entendendo imagens e DockerHub

As imagens ficam armazenadas no [Docker Registry, ou Docker Hub](https://hub.docker.com/). Lá contém as versões (sendo estas latest ou releases fixas).

Para consultas as imagens existentes na máquina, deve rodar o comando:

```bash
$ docker images

# OUTPUT:
#
# REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
# ubuntu        latest    a7870fd478f4   33 hours ago   69.2MB
# nginx         latest    8f05d7383593   11 days ago    134MB
# hello-world   latest    46331d942d63   2 months ago   9.14kB
```

Para baixar uma imagem para a máquina

```bash
$ docker pull php
```

Com uma tag específica

```bash
$ docker pull php:rc-alpine
```

Para excluir imagens

```bash
$ docker rmi php:latest # É necessário incluir a tag
```

#### Criando serviço de Banco de dados Postgres:
`https://hub.docker.com/_/postgres`

Inicialização:

```shell
$ docker run --name database -e POSTGRES_PASSWORD=docker -p 5432:5432 -d postgres:11
```
Ao finalizar, exibirá o id do container

## Dockerfile e Docker Compose

#### Arquivo Dockerfile

É o arquivo de configurações que executará os comandos iniciais do conteiner.

**Exemplo:**

```dockerfile
# Imagem de referência
FROM node:alpine

RUN mkdir -p /home/node/api/node_modules && chown -R node:node /home/node/api
WORKDIR /home/node/api

COPY package.json yarn.* ./
USER node
RUN yarn

COPY --chown=node:node . .

CMD ["yarn", "start"]
EXPOSE 3001
```

## Docker compose

#### Arquivo docker-compose.yml

É o arquivo que instancia o conteiner.

**Exemplo:**

```yml
version: '3.6'

networks:
  portal-network:
    driver: bridge

services:
  portal-backend: # Nome do conteiner
    build:
      context: .
      dockerfile: Dockerfile
    image: nodejs
    container_name: portal-backend # Chamada do conteiner
    restart: unless-stopped
    env_file: .env
    ports:
      - "3001" # Porta ouvida pelo conteiner
    volumes:
      - .:/home/node/api
    networks:
      - portal-network
    command: yarn start # Comando executado para rodar o serviço
```

#### Arquivo .dockerignore

Arquivo responsável para ignorar arquivos/pastas não requiridas para execução do projeto

*Exemplo:*

```.dockerignore
node_modules
```
